
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>R: Baudry ML Reserving Pt 1 &#8212; Actuaries&#39; Analytical Cookbook</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="R: Baudry ML Reserving Pt 2" href="MLRWP_R_Baudry_Notebook_2_CreateReservingDatabase_v1.html" />
    <link rel="prev" title="Py: Machine Learning Triangles" href="MLRWP_Py_triangles_example.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/actuaries-logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Actuaries' Analytical Cookbook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="about_py.html">
   About Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started.html">
   Setting up Your Python Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="python_by_example.html">
   An Introductory Example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="learn_more.html">
   Learn More
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Useful_Python_packages.html">
   Useful Python packages for Data Science
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to R
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="about_R.html">
   About R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started_R.html">
   Setting Up R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="introductory_R.html">
   Introduction to R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intermediate_R.html">
   Next Steps With R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="top_ten_r_packages.html">
   Useful Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_DataTable.html">
   R: data.table for actuaries
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Workflow Management
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="version_control.html">
   Version control
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Regression, Classification and Technical Price
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_CS1.html">
   Py: Customer Churn Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multitasking_risk_pricing.html">
   Py/R: Multitasking Risk Pricing Using Deep Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="py_shap_values.html">
   Py: Explainable Models with SHAP
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Life Insurance
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="LifeRecipeBook.html">
   R: Life Modelling Recipes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="life_stats.html">
   R: Life Industry Stats in Tableau and R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bayesian-applications.html">
   R: Bayesian Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="trees.html">
   R: Decision Tree Applications
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  General Insurance
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_GLMs.html">
   R: Reserving with GLMs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_Lasso.html">
   R: Reserving with LASSO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_mlr3.html">
   R: Machine Learning Triangles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_Py_triangles_example.html">
   Py: Machine Learning Triangles
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   R: Baudry ML Reserving Pt 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_Baudry_Notebook_2_CreateReservingDatabase_v1.html">
   R: Baudry ML Reserving Pt 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_Baudry_Notebook_3_ApplyMachineLearningReserving_v1.html">
   R: Baudry ML Reserving Pt 3
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unsupervised Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_CS1.html">
   Py: Socio-Economic Index Construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_CS2.html">
   Py: Clustering Credit Card Fraud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_Ex4.html">
   Py: K-means clustering of COVID dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_Ex5.html">
   Py: Hierarchical clustering on COVID dataset
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Natural Language Processing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="R_case_study_word_cloud.html">
   R: Word Cloud Case Study
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="textClassificationEntry.html">
   Py: Text Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_Ex10.html">
   Py: Decision Tree Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_Ex18.html">
   Py: Neural Net Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M07_CS1.html">
   Py: Classifying review sentiment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M07_CS2.html">
   Py: Customer Sentiment Analysis
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Business Optimization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_2021_S2_Tutorial10_exercise_scipy.html">
   Py: Linear Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Image Recognition
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_CS2.html">
   Py: Image Recognition
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Ethics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="automated_decision.html">
   Automated Decision-Making Systems
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="zbibliography.html">
   Bibliography
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="contributing.html">
   Contributing
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ActuariesInstitute/cookbook/main?urlpath=tree/cookbook/docs/MLRWP_R_Baudry_Notebook_1_SimulateData_v1.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/ActuariesInstitute/cookbook/blob/main/cookbook/docs/MLRWP_R_Baudry_Notebook_1_SimulateData_v1.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ActuariesInstitute/cookbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ActuariesInstitute/cookbook/edit/main/cookbook/docs/MLRWP_R_Baudry_Notebook_1_SimulateData_v1.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/docs/MLRWP_R_Baudry_Notebook_1_SimulateData_v1.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   R: Baudry ML Reserving Pt 1
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-policy-data-set">
   Create Policy Data set
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-count-by-date">
     Policy count by date
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-covers-by-date">
     Policy covers by date
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-transaction-file">
     Policy transaction file
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#policy-date-number">
       Policy date &amp; number
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#policy-coverage-type">
       Policy coverage type
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#policy-brand-price-model-features">
       Policy Brand, Price, Model features
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tidy-and-save">
       Tidy and save
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-claims-file">
   Create claims file
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sample-claims-from-policies">
     Sample Claims from Policies
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#breakage-claims">
       Breakage Claims
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#oxidation-claims">
       Oxidation Claims
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#theft-claims">
       Theft Claims
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#claim-dates-and-costs">
     Claim dates and costs
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#policy-uw-date-and-value">
       Policy UW_date and value
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-simulated-claim-occrrence-reporting-and-payment-delays">
       Add simulated Claim occrrence, reporting and payment delays
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#claim-key-and-tidy">
       Claim key and tidy
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-exhibits">
   Checking exhibits
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#function-to-create-policy-and-claim-data">
   Function to create policy and claim data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-the-code-and-try-it-yourself">
   Download the code and try it yourself
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>R: Baudry ML Reserving Pt 1</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   R: Baudry ML Reserving Pt 1
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-policy-data-set">
   Create Policy Data set
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-count-by-date">
     Policy count by date
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-covers-by-date">
     Policy covers by date
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-transaction-file">
     Policy transaction file
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#policy-date-number">
       Policy date &amp; number
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#policy-coverage-type">
       Policy coverage type
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#policy-brand-price-model-features">
       Policy Brand, Price, Model features
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tidy-and-save">
       Tidy and save
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-claims-file">
   Create claims file
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sample-claims-from-policies">
     Sample Claims from Policies
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#breakage-claims">
       Breakage Claims
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#oxidation-claims">
       Oxidation Claims
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#theft-claims">
       Theft Claims
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#claim-dates-and-costs">
     Claim dates and costs
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#policy-uw-date-and-value">
       Policy UW_date and value
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-simulated-claim-occrrence-reporting-and-payment-delays">
       Add simulated Claim occrrence, reporting and payment delays
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#claim-key-and-tidy">
       Claim key and tidy
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-exhibits">
   Checking exhibits
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#function-to-create-policy-and-claim-data">
   Function to create policy and claim data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-the-code-and-try-it-yourself">
   Download the code and try it yourself
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="r-baudry-ml-reserving-pt-1">
<h1>R: Baudry ML Reserving Pt 1<a class="headerlink" href="#r-baudry-ml-reserving-pt-1" title="Permalink to this headline">#</a></h1>
<p><em>This article was originally created by Nigel Carpenter and published in the <a class="reference external" href="https://institute-and-faculty-of-actuaries.github.io/mlr-blog/">General Insurance Machine Learning for Reserving Working Party (“MLR-WP”) blog</a>. The MLR-WP is an international research group on machine learning techniques to reserving, with over 50 actuaries from around the globe. The goal of the group is to bring machine learning techniques into widespread adoption ‘on the ground’ by identifying what the barriers are, communicating any benefits, and helping develop the research techniques in pragmatic ways. Whilst some articles have been brought into this cookbook, consider exploring the <a class="reference external" href="https://institute-and-faculty-of-actuaries.github.io/mlr-blog/">blog</a> further for additional content including detailed walkthroughs of more advanced models.</em></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h1>
<p>This is the first notebook of a series of three that outlines and elaborates upon code used to replicate the central scenario in the paper of Maximilien Baudry “NON-PARAMETRIC INDIVIDUAL
CLAIM RESERVING IN INSURANCE” (<a class="reference external" href="https://www.institutdesactuaires.com/global/gene/link.php?doc_id=11747&amp;fg=1">Presentation</a> <a class="reference external" href="http://www.ressources-actuarielles.net/EXT/ISFA/1226.nsf/0/6b3d579479584e35c12581eb00468777/%24FILE/Reserving-article.pdf">Paper</a>)</p>
<p>Below we step through the process to create a single simulated dataset, as set out in Section 5 of Baudry’s paper. Having stepped through the data creation process, at the end, we present the code in the form of a function that returns a simulated policy and claim dataset.</p>
<p>The second notebook details the process for creating a reserving database and the third outlines the process for creating reserves using machine learning.</p>
<p>Before we start we import a few pre-requisite R packages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing packages</span>
<span class="nf">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">repr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">kableExtra</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">IRdisplay</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Attaching package: ‘lubridate’


The following objects are masked from ‘package:data.table’:

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year


The following objects are masked from ‘package:base’:

    date, intersect, setdiff, union



Attaching package: ‘cowplot’


The following object is masked from ‘package:lubridate’:

    stamp
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="create-policy-data-set">
<h1>Create Policy Data set<a class="headerlink" href="#create-policy-data-set" title="Permalink to this headline">#</a></h1>
<p>We start by simulating number of policies sold by day and by policy coverage type.</p>
<section id="policy-count-by-date">
<h2>Policy count by date<a class="headerlink" href="#policy-count-by-date" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># polices sold between start 2016 to end 2017</span>
<span class="n">dt_policydates</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">date_UW</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="s">&quot;2016/1/1&quot;</span><span class="p">),</span> <span class="nf">as.Date</span><span class="p">(</span><span class="s">&quot;2017/12/31&quot;</span><span class="p">),</span> <span class="s">&quot;day&quot;</span><span class="p">))</span>

<span class="c1"># number of policies per day follows Poisson process with mean 700 (approx 255,500 pols per annum)</span>
<span class="n">dt_policydates</span><span class="p">[,</span> <span class="s">&#39;:=&#39;</span><span class="p">(</span><span class="n">policycount</span> <span class="o">=</span> <span class="nf">rpois</span><span class="p">(</span><span class="n">.N</span><span class="p">,</span><span class="m">700</span><span class="p">),</span>
                      <span class="n">date_lapse</span> <span class="o">=</span> <span class="n">date_UW</span> <span class="o">%m+%</span> <span class="nf">years</span><span class="p">(</span><span class="m">1</span><span class="p">),</span>
                      <span class="n">expodays</span> <span class="o">=</span> <span class="nf">as.integer</span><span class="p">(</span><span class="n">date_UW</span> <span class="o">%m+%</span> <span class="nf">years</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">date_UW</span><span class="p">),</span>
                      <span class="n">pol_prefix</span> <span class="o">=</span> <span class="nf">year</span><span class="p">(</span><span class="n">date_UW</span><span class="p">)</span><span class="o">*</span><span class="m">10000</span> <span class="o">+</span> <span class="nf">month</span><span class="p">(</span><span class="n">date_UW</span><span class="p">)</span><span class="o">*</span><span class="m">100</span> <span class="o">+</span> <span class="nf">mday</span><span class="p">(</span><span class="n">date_UW</span><span class="p">))]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="policy-covers-by-date">
<h2>Policy covers by date<a class="headerlink" href="#policy-covers-by-date" title="Permalink to this headline">#</a></h2>
<p>We then add policy coverage columns in proportions 25% Breakage, 45% Breakage and Oxidation and 30% Breakage, Oxidation and Theft.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add columns defining Policy Covers   </span>
<span class="n">dt_policydates</span><span class="p">[,</span> <span class="n">Cover_B</span> <span class="o">:=</span> <span class="nf">round</span><span class="p">(</span><span class="n">policycount</span> <span class="o">*</span> <span class="m">0.25</span><span class="p">)]</span>
<span class="n">dt_policydates</span><span class="p">[,</span> <span class="n">Cover_BO</span> <span class="o">:=</span> <span class="nf">round</span><span class="p">(</span><span class="n">policycount</span> <span class="o">*</span> <span class="m">0.45</span><span class="p">)]</span>
<span class="n">dt_policydates</span><span class="p">[,</span> <span class="n">Cover_BOT</span> <span class="o">:=</span> <span class="n">policycount</span> <span class="o">-</span> <span class="n">Cover_B</span> <span class="o">-</span> <span class="n">Cover_BO</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_policydates</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> date_UW </th>
   <th style="text-align:right;"> policycount </th>
   <th style="text-align:left;"> date_lapse </th>
   <th style="text-align:right;"> expodays </th>
   <th style="text-align:right;"> pol_prefix </th>
   <th style="text-align:right;"> Cover_B </th>
   <th style="text-align:right;"> Cover_BO </th>
   <th style="text-align:right;"> Cover_BOT </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 693 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:right;"> 20160101 </td>
   <td style="text-align:right;"> 173 </td>
   <td style="text-align:right;"> 312 </td>
   <td style="text-align:right;"> 208 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-02 </td>
   <td style="text-align:right;"> 690 </td>
   <td style="text-align:left;"> 2017-01-02 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:right;"> 20160102 </td>
   <td style="text-align:right;"> 172 </td>
   <td style="text-align:right;"> 310 </td>
   <td style="text-align:right;"> 208 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-03 </td>
   <td style="text-align:right;"> 716 </td>
   <td style="text-align:left;"> 2017-01-03 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:right;"> 20160103 </td>
   <td style="text-align:right;"> 179 </td>
   <td style="text-align:right;"> 322 </td>
   <td style="text-align:right;"> 215 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-04 </td>
   <td style="text-align:right;"> 714 </td>
   <td style="text-align:left;"> 2017-01-04 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:right;"> 20160104 </td>
   <td style="text-align:right;"> 178 </td>
   <td style="text-align:right;"> 321 </td>
   <td style="text-align:right;"> 215 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-05 </td>
   <td style="text-align:right;"> 727 </td>
   <td style="text-align:left;"> 2017-01-05 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:right;"> 20160105 </td>
   <td style="text-align:right;"> 182 </td>
   <td style="text-align:right;"> 327 </td>
   <td style="text-align:right;"> 218 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-06 </td>
   <td style="text-align:right;"> 763 </td>
   <td style="text-align:left;"> 2017-01-06 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:right;"> 20160106 </td>
   <td style="text-align:right;"> 191 </td>
   <td style="text-align:right;"> 343 </td>
   <td style="text-align:right;"> 229 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
<section id="policy-transaction-file">
<h2>Policy transaction file<a class="headerlink" href="#policy-transaction-file" title="Permalink to this headline">#</a></h2>
<p>We then create a policy transaction file containing 1 row per policy, with columns to indicate policy coverage details.</p>
<section id="policy-date-number">
<h3>Policy date &amp; number<a class="headerlink" href="#policy-date-number" title="Permalink to this headline">#</a></h3>
<p>The first step is to create a policy table with 1 row per policy and underwriting date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># repeat rows for each policy by UW-Date</span>
<span class="n">dt_policy</span> <span class="o">&lt;-</span> <span class="n">dt_policydates</span><span class="p">[</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">.N</span><span class="p">,</span> <span class="n">policycount</span><span class="p">),</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;date_UW&quot;</span><span class="p">,</span> <span class="s">&quot;pol_prefix&quot;</span><span class="p">),</span> <span class="n">with</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">][,</span><span class="n">pol_seq</span><span class="o">:=</span><span class="m">1</span><span class="o">:</span><span class="n">.N</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="n">pol_prefix</span><span class="p">]</span>

<span class="c1"># Create a unique policy number </span>
<span class="n">dt_policy</span><span class="p">[,</span> <span class="n">pol_number</span> <span class="o">:=</span> <span class="nf">as.character</span><span class="p">(</span><span class="n">pol_prefix</span> <span class="o">*</span> <span class="m">10000</span> <span class="o">+</span> <span class="n">pol_seq</span><span class="p">)]</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> date_UW </th>
   <th style="text-align:right;"> pol_prefix </th>
   <th style="text-align:right;"> pol_seq </th>
   <th style="text-align:left;"> pol_number </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 20160101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 201601010001 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 20160101 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 201601010002 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 20160101 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:left;"> 201601010003 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 20160101 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> 201601010004 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 20160101 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> 201601010005 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 20160101 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:left;"> 201601010006 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
<section id="policy-coverage-type">
<h3>Policy coverage type<a class="headerlink" href="#policy-coverage-type" title="Permalink to this headline">#</a></h3>
<p>Then we add the policy coverage details appropriate to each row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># set join keys</span>
<span class="nf">setkey</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">,</span><span class="s">&#39;date_UW&#39;</span><span class="p">)</span>
<span class="nf">setkey</span><span class="p">(</span><span class="n">dt_policydates</span><span class="p">,</span><span class="s">&#39;date_UW&#39;</span><span class="p">)</span>  

<span class="c1"># remove pol_prefix before join</span>
<span class="n">dt_policydates</span><span class="p">[,</span> <span class="n">pol_prefix</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>  

<span class="c1"># join cover from summary file (dt_policydates)</span>
<span class="n">dt_policy</span> <span class="o">&lt;-</span> <span class="n">dt_policy</span><span class="p">[</span><span class="n">dt_policydates</span><span class="p">]</span>  

<span class="c1"># now create Cover field for each policy row</span>
<span class="n">dt_policy</span><span class="p">[,</span><span class="n">Cover</span> <span class="o">:=</span> <span class="s">&#39;BO&#39;</span><span class="p">]</span>
<span class="n">dt_policy</span><span class="p">[</span><span class="n">pol_seq</span> <span class="o">&lt;=</span> <span class="n">policycount</span><span class="o">-</span> <span class="n">Cover_BO</span><span class="p">,</span><span class="n">Cover</span> <span class="o">:=</span> <span class="s">&#39;BOT&#39;</span><span class="p">]</span>
<span class="n">dt_policy</span><span class="p">[</span><span class="n">pol_seq</span> <span class="o">&lt;=</span> <span class="n">Cover_B</span><span class="p">,</span><span class="n">Cover</span> <span class="o">:=</span> <span class="s">&#39;B&#39;</span><span class="p">]</span>  

<span class="n">dt_policy</span><span class="p">[,</span> <span class="n">Cover_B</span> <span class="o">:=</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">Cover</span><span class="p">)]</span>  

<span class="c1"># remove interim calculation fields</span>
<span class="n">dt_policy</span><span class="p">[,</span> <span class="s">&#39;:=&#39;</span><span class="p">(</span><span class="n">pol_prefix</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
                 <span class="n">policycount</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
                 <span class="n">pol_seq</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
                 <span class="n">Cover_B</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
                 <span class="n">Cover_BOT</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
                 <span class="n">Cover_BO</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)]</span>

<span class="c1"># check output</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> date_UW </th>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> date_lapse </th>
   <th style="text-align:right;"> expodays </th>
   <th style="text-align:left;"> Cover </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010001 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010002 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010003 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010004 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010005 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010006 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
<section id="policy-brand-price-model-features">
<h3>Policy Brand, Price, Model features<a class="headerlink" href="#policy-brand-price-model-features" title="Permalink to this headline">#</a></h3>
<p>Now further details can be added to the policy dataset; such as policy brand, model and price details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add remaining policy details</span>
<span class="n">dt_policy</span><span class="p">[,</span> <span class="n">Brand</span> <span class="o">:=</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">)),</span> <span class="n">length.out</span> <span class="o">=</span> <span class="n">.N</span><span class="p">)]</span>
<span class="n">dt_policy</span><span class="p">[,</span> <span class="n">Base_Price</span> <span class="o">:=</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">600</span><span class="p">,</span><span class="m">550</span><span class="p">,</span><span class="m">300</span><span class="p">,</span><span class="m">150</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">)),</span> <span class="n">length.out</span> <span class="o">=</span> <span class="n">.N</span><span class="p">)]</span>

<span class="c1"># models types and model cost multipliers</span>
<span class="nf">for </span><span class="p">(</span><span class="n">eachBrand</span> <span class="n">in</span> <span class="nf">unique</span><span class="p">(</span><span class="n">dt_policy</span><span class="o">$</span><span class="n">Brand</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">dt_policy</span><span class="p">[</span><span class="n">Brand</span> <span class="o">==</span> <span class="n">eachBrand</span><span class="p">,</span> <span class="n">Model</span> <span class="o">:=</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="n">length.out</span> <span class="o">=</span> <span class="n">.N</span><span class="p">)]</span>
  <span class="n">dt_policy</span><span class="p">[</span><span class="n">Brand</span> <span class="o">==</span> <span class="n">eachBrand</span><span class="p">,</span> <span class="n">Model_mult</span> <span class="o">:=</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1.15</span><span class="o">^</span><span class="m">3</span><span class="p">,</span> <span class="m">1.15</span><span class="o">^</span><span class="m">2</span><span class="p">,</span> <span class="m">1.15</span><span class="o">^</span><span class="m">1</span><span class="p">,</span> <span class="m">1.15</span><span class="o">^</span><span class="m">0</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="n">length.out</span> <span class="o">=</span> <span class="n">.N</span><span class="p">)]</span>
<span class="p">}</span>

<span class="n">dt_policy</span><span class="p">[,</span> <span class="n">Price</span> <span class="o">:=</span> <span class="nf">ceiling </span><span class="p">(</span><span class="n">Base_Price</span> <span class="o">*</span> <span class="n">Model_mult</span><span class="p">)]</span>

<span class="c1"># check output</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> date_UW </th>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> date_lapse </th>
   <th style="text-align:right;"> expodays </th>
   <th style="text-align:left;"> Cover </th>
   <th style="text-align:right;"> Brand </th>
   <th style="text-align:right;"> Base_Price </th>
   <th style="text-align:right;"> Model </th>
   <th style="text-align:right;"> Model_mult </th>
   <th style="text-align:right;"> Price </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010001 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 600 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1.520875 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010002 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 600 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1.520875 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010003 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 600 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1.520875 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010004 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 600 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1.520875 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010005 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 600 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1.520875 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 201601010006 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:right;"> 366 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 600 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1.520875 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
<section id="tidy-and-save">
<h3>Tidy and save<a class="headerlink" href="#tidy-and-save" title="Permalink to this headline">#</a></h3>
<p>The final step is to keep only columns of interest and save the resulting policy file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># colums to keep</span>
<span class="n">cols_policy</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;pol_number&quot;</span><span class="p">,</span>
                 <span class="s">&quot;date_UW&quot;</span><span class="p">,</span>
                 <span class="s">&quot;date_lapse&quot;</span><span class="p">,</span>
                 <span class="s">&quot;Cover&quot;</span><span class="p">,</span>
                 <span class="s">&quot;Brand&quot;</span><span class="p">,</span>
                 <span class="s">&quot;Model&quot;</span><span class="p">,</span>
                 <span class="s">&quot;Price&quot;</span><span class="p">)</span>

<span class="n">dt_policy</span> <span class="o">&lt;-</span> <span class="n">dt_policy</span><span class="p">[,</span> <span class="n">cols_policy</span><span class="p">,</span> <span class="n">with</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">]</span>

<span class="c1"># check output</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>

<span class="nf">save</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="s">&quot;./dt_policy.rda&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> date_UW </th>
   <th style="text-align:left;"> date_lapse </th>
   <th style="text-align:left;"> Cover </th>
   <th style="text-align:right;"> Brand </th>
   <th style="text-align:right;"> Model </th>
   <th style="text-align:right;"> Price </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 201601010001 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010002 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010003 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010004 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010005 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010006 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:left;"> 2017-01-01 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 913 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="create-claims-file">
<h1>Create claims file<a class="headerlink" href="#create-claims-file" title="Permalink to this headline">#</a></h1>
<section id="sample-claims-from-policies">
<h2>Sample Claims from Policies<a class="headerlink" href="#sample-claims-from-policies" title="Permalink to this headline">#</a></h2>
<p>We now simulate claims arising from the policy coverages. Claim rates vary by policy coverage and type.</p>
<section id="breakage-claims">
<h3>Breakage Claims<a class="headerlink" href="#breakage-claims" title="Permalink to this headline">#</a></h3>
<p>We start with breakages claims and sample from the policies data set to create claims.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># All policies have breakage cover</span>
<span class="c1"># claims uniformly sampled from policies</span>
<span class="n">claim</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">)</span> <span class="o">*</span> <span class="m">0.15</span><span class="p">))</span>

<span class="c1"># Claim severity multiplier sampled from beta distribution</span>
<span class="n">dt_claim</span> <span class="o">&lt;-</span> <span class="nf">data.table</span><span class="p">(</span><span class="n">pol_number</span> <span class="o">=</span> <span class="n">dt_policy</span><span class="p">[</span><span class="n">claim</span><span class="p">,</span> <span class="n">pol_number</span><span class="p">],</span>
                       <span class="n">claim_type</span> <span class="o">=</span> <span class="s">&#39;B&#39;</span><span class="p">,</span>
                       <span class="n">claim_count</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
                       <span class="n">claim_sev</span> <span class="o">=</span> <span class="nf">rbeta</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">claim</span><span class="p">),</span> <span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">))</span>

<span class="c1"># check output</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> claim_type </th>
   <th style="text-align:right;"> claim_count </th>
   <th style="text-align:right;"> claim_sev </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 201706250197 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0066006 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201702160566 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.1305747 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201703080185 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.3325863 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201709090113 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2690556 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201604260297 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2531805 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201707310143 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.1357897 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
<section id="oxidation-claims">
<h3>Oxidation Claims<a class="headerlink" href="#oxidation-claims" title="Permalink to this headline">#</a></h3>
<p>Oxidation claims follow a similar process, just with different incidence rates and severities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># identify all policies with Oxidation cover</span>
<span class="n">cov</span> <span class="o">&lt;-</span> <span class="nf">which</span><span class="p">(</span><span class="n">dt_policy</span><span class="o">$</span><span class="n">Cover</span> <span class="o">!=</span> <span class="s">&#39;B&#39;</span><span class="p">)</span>

<span class="c1"># sample claims from policies with cover</span>
<span class="n">claim</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span> <span class="o">*</span> <span class="m">0.05</span><span class="p">))</span>

<span class="c1"># add claims to table </span>
<span class="n">dt_claim</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">,</span>
                  <span class="nf">data.table</span><span class="p">(</span><span class="n">pol_number</span> <span class="o">=</span> <span class="n">dt_policy</span><span class="p">[</span><span class="n">claim</span><span class="p">,</span> <span class="n">pol_number</span><span class="p">],</span>
                             <span class="n">claim_type</span> <span class="o">=</span> <span class="s">&#39;O&#39;</span><span class="p">,</span>
                             <span class="n">claim_count</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
                             <span class="n">claim_sev</span> <span class="o">=</span> <span class="nf">rbeta</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">claim</span><span class="p">),</span> <span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">)))</span>

<span class="c1"># check output</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> claim_type </th>
   <th style="text-align:right;"> claim_count </th>
   <th style="text-align:right;"> claim_sev </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 201706250197 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0066006 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201702160566 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.1305747 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201703080185 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.3325863 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201709090113 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2690556 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201604260297 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2531805 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201707310143 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.1357897 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
<section id="theft-claims">
<h3>Theft Claims<a class="headerlink" href="#theft-claims" title="Permalink to this headline">#</a></h3>
<p>In the original paper the distribution for Theft severity claims is stated to be Beta(alpha = 5, beta = 0.5).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># identify all policies with Theft cover</span>
<span class="c1"># for Theft claim frequency varies by Brand</span>
<span class="c1"># So need to consider each in turn...</span>

<span class="nf">for</span><span class="p">(</span><span class="n">myModel</span> <span class="n">in</span> <span class="m">0</span><span class="o">:</span><span class="m">3</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">cov</span> <span class="o">&lt;-</span> <span class="nf">which</span><span class="p">(</span><span class="n">dt_policy</span><span class="o">$</span><span class="n">Cover</span> <span class="o">==</span> <span class="s">&#39;BOT&#39;</span> <span class="o">&amp;</span> <span class="n">dt_policy</span><span class="o">$</span><span class="n">Model</span> <span class="o">==</span> <span class="n">myModel</span><span class="p">)</span>
    <span class="n">claim</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span> <span class="o">*</span> <span class="m">0.05</span><span class="o">*</span><span class="p">(</span><span class="m">1</span> <span class="o">+</span> <span class="n">myModel</span><span class="p">)))</span>
  
    <span class="n">dt_claim</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">,</span>
                      <span class="nf">data.table</span><span class="p">(</span><span class="n">pol_number</span> <span class="o">=</span> <span class="n">dt_policy</span><span class="p">[</span><span class="n">claim</span><span class="p">,</span> <span class="n">pol_number</span><span class="p">],</span>
                                 <span class="n">claim_type</span> <span class="o">=</span> <span class="s">&#39;T&#39;</span><span class="p">,</span>
                                 <span class="n">claim_count</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
                                 <span class="n">claim_sev</span> <span class="o">=</span> <span class="nf">rbeta</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">claim</span><span class="p">),</span> <span class="m">5</span><span class="p">,</span><span class="n">.</span><span class="m">5</span><span class="p">)))</span>
<span class="p">}</span>

<span class="c1"># check output</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">tail</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> claim_type </th>
   <th style="text-align:right;"> claim_count </th>
   <th style="text-align:right;"> claim_sev </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 201706250197 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0066006 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201702160566 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.1305747 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201703080185 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.3325863 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201709090113 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2690556 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201604260297 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2531805 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201707310143 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.1357897 </td>
  </tr>
</tbody>
</table></div></div><div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> claim_type </th>
   <th style="text-align:right;"> claim_count </th>
   <th style="text-align:right;"> claim_sev </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 201708230205 </td>
   <td style="text-align:left;"> T </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.9648917 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201701280297 </td>
   <td style="text-align:left;"> T </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.8245351 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201701020337 </td>
   <td style="text-align:left;"> T </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.7794176 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201605080388 </td>
   <td style="text-align:left;"> T </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.8335502 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201608140365 </td>
   <td style="text-align:left;"> T </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.9262032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201710040235 </td>
   <td style="text-align:left;"> T </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.6904011 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
</section>
<section id="claim-dates-and-costs">
<h2>Claim dates and costs<a class="headerlink" href="#claim-dates-and-costs" title="Permalink to this headline">#</a></h2>
<section id="policy-uw-date-and-value">
<h3>Policy UW_date and value<a class="headerlink" href="#policy-uw-date-and-value" title="Permalink to this headline">#</a></h3>
<p>We now need to add details to claims, such as policy underwritng date and phone cost.
These details come from the policy table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># set join keys</span>
<span class="nf">setkey</span><span class="p">(</span><span class="n">dt_policy</span><span class="p">,</span> <span class="n">pol_number</span><span class="p">)</span>
<span class="nf">setkey</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">,</span> <span class="n">pol_number</span><span class="p">)</span>

<span class="c1">#join Brand and Price from policy to claim</span>
<span class="n">dt_claim</span><span class="p">[</span><span class="n">dt_policy</span><span class="p">,</span>
         <span class="n">on</span> <span class="o">=</span> <span class="s">&#39;pol_number&#39;</span><span class="p">,</span>
         <span class="s">&#39;:=&#39;</span><span class="p">(</span><span class="n">date_UW</span> <span class="o">=</span> <span class="n">i.date_UW</span><span class="p">,</span>
              <span class="n">Price</span> <span class="o">=</span> <span class="n">i.Price</span><span class="p">,</span>
              <span class="n">Brand</span> <span class="o">=</span> <span class="n">i.Brand</span><span class="p">)]</span>

<span class="c1"># check output</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> claim_type </th>
   <th style="text-align:right;"> claim_count </th>
   <th style="text-align:right;"> claim_sev </th>
   <th style="text-align:left;"> date_UW </th>
   <th style="text-align:right;"> Price </th>
   <th style="text-align:right;"> Brand </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 201601010003 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2786004 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 913 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010019 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.3383702 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 229 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010021 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2924503 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 913 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010028 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2193067 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 794 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010032 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2106113 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 837 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201601010047 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.1108387 </td>
   <td style="text-align:left;"> 2016-01-01 </td>
   <td style="text-align:right;"> 913 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
<section id="add-simulated-claim-occrrence-reporting-and-payment-delays">
<h3>Add simulated Claim occrrence, reporting and payment delays<a class="headerlink" href="#add-simulated-claim-occrrence-reporting-and-payment-delays" title="Permalink to this headline">#</a></h3>
<p>The occurrence delay is assumed uniform over policy exposure period.
Reporting and payment delays are assumed to follow Beta distributions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># use lubridate %m+% date addition operator </span>
<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">date_lapse</span> <span class="o">:=</span> <span class="n">date_UW</span> <span class="o">%m+%</span> <span class="nf">years</span><span class="p">(</span><span class="m">1</span><span class="p">)]</span>
<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">expodays</span> <span class="o">:=</span> <span class="nf">as.integer</span><span class="p">(</span><span class="n">date_lapse</span> <span class="o">-</span> <span class="n">date_UW</span><span class="p">)]</span>
<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">occ_delay_days</span> <span class="o">:=</span> <span class="nf">floor</span><span class="p">(</span><span class="n">expodays</span> <span class="o">*</span> <span class="nf">runif</span><span class="p">(</span><span class="n">.N</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))]</span>

<span class="n">dt_claim</span><span class="p">[</span> <span class="p">,</span><span class="n">delay_report</span> <span class="o">:=</span> <span class="nf">floor</span><span class="p">(</span><span class="m">365</span> <span class="o">*</span> <span class="nf">rbeta</span><span class="p">(</span><span class="n">.N</span><span class="p">,</span> <span class="n">.</span><span class="m">4</span><span class="p">,</span> <span class="m">10</span><span class="p">))]</span>  
<span class="n">dt_claim</span><span class="p">[</span> <span class="p">,</span><span class="n">delay_pay</span> <span class="o">:=</span> <span class="nf">floor</span><span class="p">(</span><span class="m">10</span> <span class="o">+</span> <span class="m">40</span><span class="o">*</span> <span class="nf">rbeta</span><span class="p">(</span><span class="n">.N</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span><span class="m">7</span><span class="p">))]</span>  

<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">date_occur</span> <span class="o">:=</span> <span class="n">date_UW</span> <span class="o">%m+%</span> <span class="nf">days</span><span class="p">(</span><span class="n">occ_delay_days</span><span class="p">)]</span>
<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">date_report</span> <span class="o">:=</span> <span class="n">date_occur</span> <span class="o">%m+%</span> <span class="nf">days</span><span class="p">(</span><span class="n">delay_report</span><span class="p">)]</span>
<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">date_pay</span> <span class="o">:=</span> <span class="n">date_report</span> <span class="o">%m+%</span> <span class="nf">days</span><span class="p">(</span><span class="n">delay_pay</span><span class="p">)]</span>

<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">claim_cost</span> <span class="o">:=</span> <span class="nf">round</span><span class="p">(</span><span class="n">Price</span> <span class="o">*</span> <span class="n">claim_sev</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># check output</span>
<span class="nf">head</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.table: 6 × 16</caption>
<thead>
	<tr><th scope=col>pol_number</th><th scope=col>claim_type</th><th scope=col>claim_count</th><th scope=col>claim_sev</th><th scope=col>date_UW</th><th scope=col>Price</th><th scope=col>Brand</th><th scope=col>date_lapse</th><th scope=col>expodays</th><th scope=col>occ_delay_days</th><th scope=col>delay_report</th><th scope=col>delay_pay</th><th scope=col>date_occur</th><th scope=col>date_report</th><th scope=col>date_pay</th><th scope=col>claim_cost</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;date&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;date&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;date&gt;</th><th scope=col>&lt;date&gt;</th><th scope=col>&lt;date&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>201601010003</td><td>B</td><td>1</td><td>0.2786004</td><td>2016-01-01</td><td>913</td><td>1</td><td>2017-01-01</td><td>366</td><td>173</td><td>71</td><td>28</td><td>2016-06-22</td><td>2016-09-01</td><td>2016-09-29</td><td>254</td></tr>
	<tr><td>201601010019</td><td>B</td><td>1</td><td>0.3383702</td><td>2016-01-01</td><td>229</td><td>4</td><td>2017-01-01</td><td>366</td><td>139</td><td> 6</td><td>33</td><td>2016-05-19</td><td>2016-05-25</td><td>2016-06-27</td><td> 77</td></tr>
	<tr><td>201601010021</td><td>B</td><td>1</td><td>0.2924503</td><td>2016-01-01</td><td>913</td><td>1</td><td>2017-01-01</td><td>366</td><td>203</td><td> 2</td><td>30</td><td>2016-07-22</td><td>2016-07-24</td><td>2016-08-23</td><td>267</td></tr>
	<tr><td>201601010028</td><td>B</td><td>1</td><td>0.2193067</td><td>2016-01-01</td><td>794</td><td>1</td><td>2017-01-01</td><td>366</td><td>186</td><td> 1</td><td>29</td><td>2016-07-05</td><td>2016-07-06</td><td>2016-08-04</td><td>174</td></tr>
	<tr><td>201601010032</td><td>B</td><td>1</td><td>0.2106113</td><td>2016-01-01</td><td>837</td><td>2</td><td>2017-01-01</td><td>366</td><td>199</td><td>33</td><td>29</td><td>2016-07-18</td><td>2016-08-20</td><td>2016-09-18</td><td>176</td></tr>
	<tr><td>201601010047</td><td>B</td><td>1</td><td>0.1108387</td><td>2016-01-01</td><td>913</td><td>1</td><td>2017-01-01</td><td>366</td><td>141</td><td> 0</td><td>29</td><td>2016-05-21</td><td>2016-05-21</td><td>2016-06-19</td><td>101</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="claim-key-and-tidy">
<h3>Claim key and tidy<a class="headerlink" href="#claim-key-and-tidy" title="Permalink to this headline">#</a></h3>
<p>The final stage is to do some simple tidying and add a unique claim key. The file is then saved for future use.</p>
<p>Note that the original paper spoke of using a “competing hazards model” for simulating claims. I have taken this to mean that a policy can only give rise to one claim. Where the above process has simulated multiple claims against the same policy I keep only the first occurring claim.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># add a unique claimkey based upon occurence date</span>

<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">clm_prefix</span> <span class="o">:=</span> <span class="nf">year</span><span class="p">(</span><span class="n">date_occur</span><span class="p">)</span><span class="o">*</span><span class="m">10000</span> <span class="o">+</span> <span class="nf">month</span><span class="p">(</span><span class="n">date_occur</span><span class="p">)</span><span class="o">*</span><span class="m">100</span> <span class="o">+</span> <span class="nf">mday</span><span class="p">(</span><span class="n">date_occur</span><span class="p">)]</span>
<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">clm_seq</span> <span class="o">:=</span> <span class="nf">seq_len</span><span class="p">(</span><span class="n">.N</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">clm_prefix</span><span class="p">]</span>
<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">clm_number</span> <span class="o">:=</span> <span class="nf">as.character</span><span class="p">(</span><span class="n">clm_prefix</span> <span class="o">*</span> <span class="m">10000</span> <span class="o">+</span> <span class="n">clm_seq</span><span class="p">)]</span>


<span class="c1"># keep only first claim against policy (competing hazards)</span>
<span class="nf">setkeyv</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;pol_number&quot;</span><span class="p">,</span> <span class="s">&quot;clm_prefix&quot;</span><span class="p">))</span>
<span class="n">dt_claim</span><span class="p">[,</span> <span class="n">polclm_seq</span> <span class="o">:=</span> <span class="nf">seq_len</span><span class="p">(</span><span class="n">.N</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">.</span><span class="p">(</span><span class="n">pol_number</span><span class="p">)]</span>
<span class="n">dt_claim</span> <span class="o">&lt;-</span> <span class="n">dt_claim</span><span class="p">[</span><span class="n">polclm_seq</span> <span class="o">==</span> <span class="m">1</span><span class="p">,]</span>

<span class="c1"># colums to keep</span>
<span class="n">cols_claim</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;clm_number&quot;</span><span class="p">,</span>
                <span class="s">&quot;pol_number&quot;</span><span class="p">,</span>
                <span class="s">&quot;claim_type&quot;</span><span class="p">,</span>
                <span class="s">&quot;claim_count&quot;</span><span class="p">,</span>
                <span class="s">&quot;claim_sev&quot;</span><span class="p">,</span>
                <span class="s">&quot;date_occur&quot;</span><span class="p">,</span>
                <span class="s">&quot;date_report&quot;</span><span class="p">,</span>
                <span class="s">&quot;date_pay&quot;</span><span class="p">,</span>
                <span class="s">&quot;claim_cost&quot;</span><span class="p">)</span>

<span class="n">dt_claim</span> <span class="o">&lt;-</span> <span class="n">dt_claim</span><span class="p">[,</span> <span class="n">cols_claim</span><span class="p">,</span> <span class="n">with</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">]</span>

<span class="c1"># check output</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>

<span class="nf">save</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="s">&quot;./dt_claim.rda&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> clm_number </th>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> claim_type </th>
   <th style="text-align:right;"> claim_count </th>
   <th style="text-align:right;"> claim_sev </th>
   <th style="text-align:left;"> date_occur </th>
   <th style="text-align:left;"> date_report </th>
   <th style="text-align:left;"> date_pay </th>
   <th style="text-align:right;"> claim_cost </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 201606220001 </td>
   <td style="text-align:left;"> 201601010003 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2786004 </td>
   <td style="text-align:left;"> 2016-06-22 </td>
   <td style="text-align:left;"> 2016-09-01 </td>
   <td style="text-align:left;"> 2016-09-29 </td>
   <td style="text-align:right;"> 254 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201605190001 </td>
   <td style="text-align:left;"> 201601010019 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.3383702 </td>
   <td style="text-align:left;"> 2016-05-19 </td>
   <td style="text-align:left;"> 2016-05-25 </td>
   <td style="text-align:left;"> 2016-06-27 </td>
   <td style="text-align:right;"> 77 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201607220001 </td>
   <td style="text-align:left;"> 201601010021 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2924503 </td>
   <td style="text-align:left;"> 2016-07-22 </td>
   <td style="text-align:left;"> 2016-07-24 </td>
   <td style="text-align:left;"> 2016-08-23 </td>
   <td style="text-align:right;"> 267 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201607050001 </td>
   <td style="text-align:left;"> 201601010028 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2193067 </td>
   <td style="text-align:left;"> 2016-07-05 </td>
   <td style="text-align:left;"> 2016-07-06 </td>
   <td style="text-align:left;"> 2016-08-04 </td>
   <td style="text-align:right;"> 174 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201607180001 </td>
   <td style="text-align:left;"> 201601010032 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2106113 </td>
   <td style="text-align:left;"> 2016-07-18 </td>
   <td style="text-align:left;"> 2016-08-20 </td>
   <td style="text-align:left;"> 2016-09-18 </td>
   <td style="text-align:right;"> 176 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201605210001 </td>
   <td style="text-align:left;"> 201601010047 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.1108387 </td>
   <td style="text-align:left;"> 2016-05-21 </td>
   <td style="text-align:left;"> 2016-05-21 </td>
   <td style="text-align:left;"> 2016-06-19 </td>
   <td style="text-align:right;"> 101 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="checking-exhibits">
<h1>Checking exhibits<a class="headerlink" href="#checking-exhibits" title="Permalink to this headline">#</a></h1>
<p>Baudry’s paper produced a number of summary exhibits from the simulated data. Let’s recreate them to get some comfort that we have correctly recreated the data.</p>
<p>You can see that the severity exhibit, Chart B, is inconsistent with that presented in the original paper. The cause of that difference is unclear at the time of writing. It’s likely to be because something nearer to a Beta(alpha = 5, beta = 0.05) has been used. However using that creates other discrepancies likely to be due to issues with the competing hazards implementation.  For now we note the differences and continue with the data as created here.</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/MLRWP_R_Baudry_Notebook_1_SimulateData_v1_30_0.png" src="../_images/MLRWP_R_Baudry_Notebook_1_SimulateData_v1_30_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dt_claim</span><span class="p">[,</span> <span class="n">Days_reportdelay</span> <span class="o">:=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="nf">difftime</span><span class="p">(</span><span class="n">date_report</span><span class="p">,</span> <span class="n">date_occur</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&quot;days&quot;</span><span class="p">))]</span>


<span class="nf">hist</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">[,</span> <span class="n">Days_reportdelay</span><span class="p">],</span><span class="n">breaks</span> <span class="o">=</span> <span class="m">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/MLRWP_R_Baudry_Notebook_1_SimulateData_v1_31_0.png" src="../_images/MLRWP_R_Baudry_Notebook_1_SimulateData_v1_31_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dt_claim</span><span class="p">[,</span> <span class="n">Days_paymentdelay</span> <span class="o">:=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="nf">difftime</span><span class="p">(</span><span class="n">date_pay</span><span class="p">,</span> <span class="n">date_report</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&quot;days&quot;</span><span class="p">))]</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">dt_claim</span><span class="p">[,</span> <span class="n">Days_paymentdelay</span><span class="p">],</span><span class="n">breaks</span> <span class="o">=</span> <span class="m">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/MLRWP_R_Baudry_Notebook_1_SimulateData_v1_32_0.png" src="../_images/MLRWP_R_Baudry_Notebook_1_SimulateData_v1_32_0.png" />
</div>
</div>
<p>The final set of exhibits are those on slide 44. The only difference of note here is in Chart B, the Claim Rate by phone brand.</p>
<p>Baudry’s exhibits show Brand 1 to have a 5% higher claim frequency than other Brands. From reading the paper I can’t see why we should expect that to be the case. Claim rate varies by phone Model but Model incidence doesn’t vary by Brand. Therefore I can’t see how the Chart B equivalent could be correct given the details in the paper.</p>
<p>I leave the code as is noting the difference but recognising that it will not affect the wider aims of the paper.</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/MLRWP_R_Baudry_Notebook_1_SimulateData_v1_34_0.png" src="../_images/MLRWP_R_Baudry_Notebook_1_SimulateData_v1_34_0.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="function-to-create-policy-and-claim-data">
<h1>Function to create policy and claim data<a class="headerlink" href="#function-to-create-policy-and-claim-data" title="Permalink to this headline">#</a></h1>
<p>The above code can be wrapped into a function which returns a list containing the policy and claim datasets.</p>
<p>By calling the function with a seed you can simulate policy and claim datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tmp</span> <span class="o">&lt;-</span> <span class="nf">simulate_central_scenario</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">tmp</span><span class="o">$</span><span class="n">dt_claim</span><span class="p">),</span> <span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">kable_styling</span><span class="p">(</span><span class="s">&quot;striped&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">scroll_box</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100%&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.character</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">display_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; "><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> clm_number </th>
   <th style="text-align:left;"> pol_number </th>
   <th style="text-align:left;"> claim_type </th>
   <th style="text-align:right;"> claim_count </th>
   <th style="text-align:right;"> claim_sev </th>
   <th style="text-align:left;"> date_occur </th>
   <th style="text-align:left;"> date_report </th>
   <th style="text-align:left;"> date_pay </th>
   <th style="text-align:right;"> claim_cost </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 201606080001 </td>
   <td style="text-align:left;"> 201601010001 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.3337923 </td>
   <td style="text-align:left;"> 2016-06-08 </td>
   <td style="text-align:left;"> 2016-06-08 </td>
   <td style="text-align:left;"> 2016-07-21 </td>
   <td style="text-align:right;"> 305 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201609150001 </td>
   <td style="text-align:left;"> 201601010014 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.3692034 </td>
   <td style="text-align:left;"> 2016-09-15 </td>
   <td style="text-align:left;"> 2016-09-15 </td>
   <td style="text-align:left;"> 2016-10-17 </td>
   <td style="text-align:right;"> 309 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201609090001 </td>
   <td style="text-align:left;"> 201601010025 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.4496012 </td>
   <td style="text-align:left;"> 2016-09-09 </td>
   <td style="text-align:left;"> 2016-09-09 </td>
   <td style="text-align:left;"> 2016-10-07 </td>
   <td style="text-align:right;"> 357 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201602190001 </td>
   <td style="text-align:left;"> 201601010027 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.4019731 </td>
   <td style="text-align:left;"> 2016-01-25 </td>
   <td style="text-align:left;"> 2016-02-19 </td>
   <td style="text-align:left;"> 2016-03-21 </td>
   <td style="text-align:right;"> 319 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201605140001 </td>
   <td style="text-align:left;"> 201601010043 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2146653 </td>
   <td style="text-align:left;"> 2016-05-14 </td>
   <td style="text-align:left;"> 2016-05-14 </td>
   <td style="text-align:left;"> 2016-06-15 </td>
   <td style="text-align:right;"> 196 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 201612110001 </td>
   <td style="text-align:left;"> 201601010045 </td>
   <td style="text-align:left;"> B </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2783313 </td>
   <td style="text-align:left;"> 2016-12-11 </td>
   <td style="text-align:left;"> 2016-12-11 </td>
   <td style="text-align:left;"> 2017-01-06 </td>
   <td style="text-align:right;"> 254 </td>
  </tr>
</tbody>
</table></div></div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download-the-code-and-try-it-yourself">
<h1>Download the code and try it yourself<a class="headerlink" href="#download-the-code-and-try-it-yourself" title="Permalink to this headline">#</a></h1>
<p>To finish, if you wish to try out this code in your own local instance of R then we have made this code and the supporting files and folders available in a zip file <span class="xref myst">here</span>.</p>
<p>Download and extract the zip file to a local directory and then open the R project file <code class="docutils literal notranslate"><span class="pre">Baudry_1.rproj</span></code> in your local R software installation. In the root of the project folder you will see two files;</p>
<ol class="simple">
<li><p>Notebook_1_SimulateData_v1.Rmd - which is the source code used to recreate this notebook</p></li>
<li><p>Notebook_1_SimulateData_v1.R - the equivalent code provided as an R script</p></li>
</ol>
<p>Please note that, depending upon your R installation , you may have to install R libraries before you can run the code provided. R will warn you if you have missing dependencies and you can then install them from CRAN.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ActuariesInstitute/cookbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="MLRWP_Py_triangles_example.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Py: Machine Learning Triangles</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="MLRWP_R_Baudry_Notebook_2_CreateReservingDatabase_v1.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">R: Baudry ML Reserving Pt 2</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By YDAWG, DAPC, YAC and other contributors.<br/>
  
    <div class="extra_footer">
       The Actuaries' Analytical Cookbook is a series of data and analytics recipes to help actuaries quickly get started with a new project.   This site is intended to be a resource to actuaries in both data science and traditional fields.  Opinions expressed in this publication are the opinions of contributors and do not necessarily represent those of either the Institute of Actuaries of Australia (the ‘Institute’), its members, directors, officers, employees, agents, or that of the employers of the contributors. <br>© Institute of Actuaries of Australia and Contributors 2021. All rights reserved.
    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>