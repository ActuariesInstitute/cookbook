
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Py: Customer Sentiment Analysis &#8212; Actuaries&#39; Analytical Cookbook</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Py: Linear Programming" href="DAA_2021_S2_Tutorial10_exercise_scipy.html" />
    <link rel="prev" title="Py: Classifying review sentiment" href="DAA_M07_CS1.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/actuaries-logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Actuaries' Analytical Cookbook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="about_py.html">
   About Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started.html">
   Setting up Your Python Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="python_by_example.html">
   An Introductory Example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="learn_more.html">
   Learn More
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Useful_Python_packages.html">
   Useful Python packages for Data Science
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to R
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="about_R.html">
   About R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started_R.html">
   Setting Up R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="introductory_R.html">
   Introduction to R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intermediate_R.html">
   Next Steps With R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="top_ten_r_packages.html">
   Useful Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_DataTable.html">
   R: data.table for actuaries
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Workflow Management
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="version_control.html">
   Version control
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Regression, Classification and Technical Price
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_CS1.html">
   Py: Customer Churn Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multitasking_risk_pricing.html">
   Py/R: Multitasking Risk Pricing Using Deep Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="py_shap_values.html">
   Py: Explainable Models with SHAP
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Life Insurance
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="LifeRecipeBook.html">
   R: Life Modelling Recipes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="life_stats.html">
   R: Life Industry Stats in Tableau and R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bayesian-applications.html">
   R: Bayesian Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="trees.html">
   R: Decision Tree Applications
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  General Insurance
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_GLMs.html">
   R: Reserving with GLMs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_Lasso.html">
   R: Reserving with LASSO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_mlr3.html">
   R: Machine Learning Triangles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_Py_triangles_example.html">
   Py: Machine Learning Triangles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_Baudry_Notebook_1_SimulateData_v1.html">
   R: Baudry ML Reserving Pt 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_Baudry_Notebook_2_CreateReservingDatabase_v1.html">
   R: Baudry ML Reserving Pt 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_Baudry_Notebook_3_ApplyMachineLearningReserving_v1.html">
   R: Baudry ML Reserving Pt 3
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unsupervised Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_CS1.html">
   Py: Socio-Economic Index Construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_CS2.html">
   Py: Clustering Credit Card Fraud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_Ex4.html">
   Py: K-means clustering of COVID dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_Ex5.html">
   Py: Hierarchical clustering on COVID dataset
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Natural Language Processing
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="R_case_study_word_cloud.html">
   R: Word Cloud Case Study
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="textClassificationEntry.html">
   Py: Text Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_Ex10.html">
   Py: Decision Tree Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_Ex18.html">
   Py: Neural Net Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M07_CS1.html">
   Py: Classifying review sentiment
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Py: Customer Sentiment Analysis
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Business Optimization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_2021_S2_Tutorial10_exercise_scipy.html">
   Py: Linear Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Image Recognition
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_CS2.html">
   Py: Image Recognition
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Ethics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="automated_decision.html">
   Automated Decision-Making Systems
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="zbibliography.html">
   Bibliography
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="contributing.html">
   Contributing
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ActuariesInstitute/cookbook/main?urlpath=tree/cookbook/docs/DAA_M07_CS2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/ActuariesInstitute/cookbook/blob/main/cookbook/docs/DAA_M07_CS2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ActuariesInstitute/cookbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ActuariesInstitute/cookbook/edit/main/cookbook/docs/DAA_M07_CS2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/docs/DAA_M07_CS2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Py: Customer Sentiment Analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#identify-the-problem">
     Identify the problem
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#packages">
     Packages
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions">
     Functions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#import-data">
       Import data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#explore-data-eda">
       Explore data (EDA)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prepare-data">
       Prepare data
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#clean-data">
         Clean data
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#subset-data">
         Subset data
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#vectorise">
         Vectorise
        </a>
        <ul class="nav section-nav flex-column">
         <li class="toc-h5 nav-item toc-entry">
          <a class="reference internal nav-link" href="#tf-idf">
           TF-IDF
          </a>
         </li>
         <li class="toc-h5 nav-item toc-entry">
          <a class="reference internal nav-link" href="#bert">
           BERT
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modelling">
     Modelling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-tf-idf-vectorisation">
       Using TF-IDF vectorisation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-bert-vectorisation">
       Using BERT vectorisation
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluate">
     Evaluate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#commentary">
   Commentary
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Py: Customer Sentiment Analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Py: Customer Sentiment Analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#identify-the-problem">
     Identify the problem
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#packages">
     Packages
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions">
     Functions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#import-data">
       Import data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#explore-data-eda">
       Explore data (EDA)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prepare-data">
       Prepare data
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#clean-data">
         Clean data
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#subset-data">
         Subset data
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#vectorise">
         Vectorise
        </a>
        <ul class="nav section-nav flex-column">
         <li class="toc-h5 nav-item toc-entry">
          <a class="reference internal nav-link" href="#tf-idf">
           TF-IDF
          </a>
         </li>
         <li class="toc-h5 nav-item toc-entry">
          <a class="reference internal nav-link" href="#bert">
           BERT
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modelling">
     Modelling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-tf-idf-vectorisation">
       Using TF-IDF vectorisation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-bert-vectorisation">
       Using BERT vectorisation
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluate">
     Evaluate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#commentary">
   Commentary
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="py-customer-sentiment-analysis">
<h1>Py: Customer Sentiment Analysis<a class="headerlink" href="#py-customer-sentiment-analysis" title="Permalink to this headline">#</a></h1>
<p><strong>This notebook was originally created by Michael Storozhev for the Data Analytics Applications subject as <em>Case study 7.2 - Customer sentiment in travel insurance</em> in the <em>DAA M07 Natural language processing</em> module.</strong></p>
<p><strong>Data Analytics Applications is a Fellowship Applications (Module 3) subject with the Actuaries Institute that aims to teach students how to apply a range of data analytics skills, such as neural networks, natural language processing, unsupervised learning and optimisation techniques, together with their professional judgement, to solve a variety of complex and challenging business problems. The business problems used as examples in this subject are drawn from a wide range of industries.</strong></p>
<p><strong>Find out more about the course <a class="reference external" href="https://www.actuaries.asn.au/education-program/fellowship/subjects-and-syllabus/data-analytics-applications-subject">here</a>.</strong></p>
<section id="identify-the-problem">
<h2>Identify the problem<a class="headerlink" href="#identify-the-problem" title="Permalink to this headline">#</a></h2>
<p>Businesses often collect feedback from their customers in the form of free-text reviews. This results in businesses receiving very rich but unstructured information about areas where they are meeting their customersâ€™ needs and areas where customers are unsatisfied.</p>
<p>It can be difficult to draw conclusions from this large volume of unstructured data without the help of NLP. The task in this case study is to analyse customer reviews in travel insurance to identify key areas of dissatisfaction. The aim for the business would then be to investigate these areas of discontent so they can improve their future customer service offering.</p>
</section>
<section id="purpose">
<h2>Purpose:<a class="headerlink" href="#purpose" title="Permalink to this headline">#</a></h2>
<p>This notebook walks through the use of NLP to analyse customer sentiment to better understand travel insurance related complaints. The objective of the case study is to identify key areas of customer satisfaction (or dissatisfaction) with travel insurance products.</p>
</section>
<section id="references">
<h2>References:<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h2>
<p>The dataset that is used in this case study was sourced from the Product Review website (<a class="reference external" href="https://www.productreview.com.au">https://www.productreview.com.au</a>). <a class="reference external" href="http://ProductReview.com.au">ProductReview.com.au</a> is a website devoted to providing consumer opinions on products, services and businesses in Australia.</p>
<p>The dataset for this case study includes 19,395 product reviews in the period May 2017 to August 2020 that relate to travel insurance from 12 different providers.</p>
</section>
<section id="packages">
<h2>Packages<a class="headerlink" href="#packages" title="Permalink to this headline">#</a></h2>
<p>This section installs packages that will be required for this exercise/case study.
n.b. for installing <code class="docutils literal notranslate"><span class="pre">wordcloud</span></code>, if <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">wordcloud</span></code> gives an error, try <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">wordcloud</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Packages for data management.</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Packages to be used in pre-processing the text.</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;stopwords&#39;</span><span class="p">)</span> <span class="c1"># For a standard list of stopwords.</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;wordnet&#39;</span><span class="p">)</span> <span class="c1"># For lemmatisation.</span>
<span class="kn">import</span> <span class="nn">pkg_resources</span>
<span class="o">!</span>pip install symspellpy
<span class="kn">from</span> <span class="nn">symspellpy</span> <span class="kn">import</span> <span class="n">SymSpell</span><span class="p">,</span> <span class="n">Verbosity</span>

<span class="c1"># Packages for visualisation.</span>
<span class="c1"># from pprint import pprint</span>
<span class="c1"># import seaborn as sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="c1"># For vectorisation using TF-IDF and t-SNE.</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>

<span class="c1"># For clustering sentences using K-Means clustering.</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="c1"># For vectorisation using BERT.</span>
<span class="o">!</span>pip install sentence_transformers
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="c1"># For evaluating the clustering model.</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">silhouette_score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nltk_data] Downloading package stopwords to /Users/Jacky/nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
[nltk_data] Downloading package wordnet to /Users/Jacky/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: symspellpy in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (6.7.0)
Requirement already satisfied: numpy&gt;=1.13.1 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from symspellpy) (1.20.3)
Requirement already satisfied: sentence_transformers in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (2.1.0)
Requirement already satisfied: torchvision in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (0.2.2)
Requirement already satisfied: tqdm in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (4.54.1)
Requirement already satisfied: nltk in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (3.6.5)
Requirement already satisfied: huggingface-hub in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (0.1.2)
Requirement already satisfied: transformers&lt;5.0.0,&gt;=4.6.0 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (4.12.5)
Requirement already satisfied: torch&gt;=1.6.0 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.9.0)
Requirement already satisfied: sentencepiece in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (0.1.96)
Requirement already satisfied: scikit-learn in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (0.24.2)
Requirement already satisfied: scipy in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.6.3)
Requirement already satisfied: numpy in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.20.3)
Requirement already satisfied: tokenizers&gt;=0.10.3 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (0.10.3)
Requirement already satisfied: tqdm in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (4.54.1)
Requirement already satisfied: requests in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (2.25.0)
Requirement already satisfied: typing-extensions&gt;=3.7.4.3 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (3.7.4.3)
Requirement already satisfied: packaging&gt;=20.9 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (20.9)
Requirement already satisfied: filelock in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (3.4.0)
Requirement already satisfied: pyyaml in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (5.4.1)
Requirement already satisfied: joblib in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from nltk-&gt;sentence_transformers) (1.0.1)
Requirement already satisfied: tqdm in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (4.54.1)
Requirement already satisfied: regex&gt;=2021.8.3 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from nltk-&gt;sentence_transformers) (2021.11.10)
Requirement already satisfied: click in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from nltk-&gt;sentence_transformers) (8.0.3)
Requirement already satisfied: pyparsing&gt;=2.0.2 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from packaging&gt;=20.9-&gt;huggingface-hub-&gt;sentence_transformers) (2.4.7)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from requests-&gt;huggingface-hub-&gt;sentence_transformers) (1.25.11)
Requirement already satisfied: chardet&lt;4,&gt;=3.0.2 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from requests-&gt;huggingface-hub-&gt;sentence_transformers) (3.0.4)
Requirement already satisfied: certifi&gt;=2017.4.17 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from requests-&gt;huggingface-hub-&gt;sentence_transformers) (2021.10.8)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from requests-&gt;huggingface-hub-&gt;sentence_transformers) (2.10)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from scikit-learn-&gt;sentence_transformers) (2.1.0)
Requirement already satisfied: joblib in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from nltk-&gt;sentence_transformers) (1.0.1)
Requirement already satisfied: numpy in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.20.3)
Requirement already satisfied: scipy in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.6.3)
Requirement already satisfied: numpy in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.20.3)
Requirement already satisfied: typing-extensions&gt;=3.7.4.3 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (3.7.4.3)
Requirement already satisfied: numpy in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.20.3)
Requirement already satisfied: six in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from torchvision-&gt;sentence_transformers) (1.15.0)
Requirement already satisfied: torch&gt;=1.6.0 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.9.0)
Requirement already satisfied: pillow&gt;=4.1.1 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from torchvision-&gt;sentence_transformers) (8.3.1)
Requirement already satisfied: tokenizers&gt;=0.10.3 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (0.10.3)
Requirement already satisfied: requests in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (2.25.0)
Requirement already satisfied: regex&gt;=2021.8.3 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from nltk-&gt;sentence_transformers) (2021.11.10)
Requirement already satisfied: pyyaml in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (5.4.1)
Requirement already satisfied: tqdm in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (4.54.1)
Requirement already satisfied: filelock in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (3.4.0)
Requirement already satisfied: sacremoses in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from transformers&lt;5.0.0,&gt;=4.6.0-&gt;sentence_transformers) (0.0.46)
Requirement already satisfied: packaging&gt;=20.9 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from huggingface-hub-&gt;sentence_transformers) (20.9)
Requirement already satisfied: numpy in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (1.20.3)
Requirement already satisfied: huggingface-hub in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (0.1.2)
Requirement already satisfied: tqdm in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from sentence_transformers) (4.54.1)
Requirement already satisfied: regex&gt;=2021.8.3 in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from nltk-&gt;sentence_transformers) (2021.11.10)
Requirement already satisfied: joblib in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from nltk-&gt;sentence_transformers) (1.0.1)
Requirement already satisfied: six in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from torchvision-&gt;sentence_transformers) (1.15.0)
Requirement already satisfied: click in /Users/Jacky/opt/miniconda3/lib/python3.9/site-packages (from nltk-&gt;sentence_transformers) (8.0.3)
</pre></div>
</div>
</div>
</div>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">#</a></h2>
<p>This section defines functions that will be used for this exercise/case study.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a function to clean text.</span>
<span class="c1"># Note that not all of these cleaning steps may be needed for different models.</span>
<span class="k">def</span> <span class="nf">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">full_clean</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Basic cleaning does the following:</span>
<span class="sd">        - converts all words to lowercase;</span>
<span class="sd">        - removes punctuation and special characters;</span>
<span class="sd">        - uses &#39;split&#39; to create tokens; and</span>
<span class="sd">        - fixes spelling mistakes.</span>

<span class="sd">        Full cleaning also does the following:</span>
<span class="sd">        - removes stop words;</span>
<span class="sd">        - performs stemming; and</span>
<span class="sd">        - performs lemmatisation.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Convert all text to lower case.</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Remove all non-digits/non-alphabetical characters (&#39;\w&#39;)</span>
    <span class="c1"># or  white spaces (&#39;\s&#39;).</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c1"># Create tokens from the text.</span>
    <span class="n">text_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="c1"># Fix spelling mistakes.</span>
    <span class="c1"># The sym_spell.lookup function highlights words that are not in the</span>
    <span class="c1"># symspell dictionary and offers suggested alternatives for these words.</span>
    <span class="n">text_list_spell</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text_list</span><span class="p">:</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="n">sym_spell</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">CLOSEST</span><span class="p">,</span> <span class="n">max_edit_distance</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="n">text_list_spell</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suggestions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">term</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">text_list</span> <span class="o">=</span> <span class="n">text_list_spell</span><span class="p">[:]</span>

    <span class="k">if</span> <span class="n">full_clean</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Remove stopwords.</span>
        <span class="n">text_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text_list</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">]</span>

        <span class="c1"># Perform stemming.</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">porter</span><span class="o">.</span><span class="n">PorterStemmer</span><span class="p">()</span>
        <span class="n">text_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ps</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text_list</span><span class="p">]</span>

        <span class="c1"># Perform lemmatisation.</span>
        <span class="n">wnl</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">wordnet</span><span class="o">.</span><span class="n">WordNetLemmatizer</span><span class="p">()</span>
        <span class="n">text_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">wnl</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text_list</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a function to create a word cloud from the words in the dataset.</span>
<span class="k">def</span> <span class="nf">get_wordcloud</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">blacklist</span><span class="o">=</span><span class="p">[]):</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting wordcloud for topic </span><span class="si">{}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">topic</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">body_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="n">dataset</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">==</span> <span class="n">topic</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">blacklist</span><span class="p">:</span>
        <span class="n">body_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">each</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">body_list</span><span class="p">]</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">body_list</span><span class="p">)</span>
    <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">560</span><span class="p">,</span>
                          <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">min_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

    <span class="c1"># plot the WordCloud image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">#</a></h2>
<p>This section:</p>
<ul class="simple">
<li><p>imports the data that will be used in the modelling;</p></li>
<li><p>explores the data; and</p></li>
<li><p>prepares the data for modelling.</p></li>
</ul>
<section id="import-data">
<h3>Import data<a class="headerlink" href="#import-data" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create dataset from the csv import.</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">&#39;https://actuariesinstitute.github.io/cookbook/_static/daa_datasets/DAA_M07_CS2_data.csv.zip&#39;</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;cp1252&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(19395, 6)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get spelling datasets.</span>
<span class="n">sym_spell</span> <span class="o">=</span> <span class="n">SymSpell</span><span class="p">(</span><span class="n">max_dictionary_edit_distance</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">prefix_length</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">dictionary_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;symspellpy&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_dictionary_en_82_765.txt&#39;</span><span class="p">)</span>
<span class="n">sym_spell</span><span class="o">.</span><span class="n">load_dictionary</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">,</span> <span class="n">term_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">count_index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Add some common words to the dictionary that are likely to be found in the</span>
<span class="c1"># case study corpus, to avoid them being incorrectly &#39;fixed&#39; by the spell checker.</span>
<span class="n">sym_spell</span><span class="o">.</span><span class="n">create_dictionary_entry</span><span class="p">(</span><span class="s1">&#39;covid&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">sym_spell</span><span class="o">.</span><span class="n">create_dictionary_entry</span><span class="p">(</span><span class="s1">&#39;coronavirus&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="explore-data-eda">
<h3>Explore data (EDA)<a class="headerlink" href="#explore-data-eda" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># View the features of the dataset.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;pubDate&#39;, &#39;rating&#39;, &#39;title&#39;, &#39;body&#39;, &#39;url&#39;, &#39;pubMonth&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the size of the dataset.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(19395, 6)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the text of the first review.</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;I used this travel insurance mainly for the car hire excess. I paid $108 for cover for a family of 5, compared to the car company  excess only insurance of $200. Booking online very easy, with immediate confirmations. I did not claim, but felt assured from other people who had needed to, giving generally positive reviews. Will definitely use this company again for future travels, and would recommend to others.\n\n&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="prepare-data">
<h3>Prepare data<a class="headerlink" href="#prepare-data" title="Permalink to this headline">#</a></h3>
<p>This section involves cleaning the data to prepare it for analysis. The following cleaning steps are taken:</p>
<ul class="simple">
<li><p>convert all words to lowercase;</p></li>
<li><p>remove punctuation and special characters;</p></li>
<li><p>use â€˜splitâ€™ to create tokens;</p></li>
<li><p>fix spelling mistakes;</p></li>
<li><p>remove stop words (when doing a full clean);</p></li>
<li><p>perform stemming (when doing a full clean); and</p></li>
<li><p>perform lemmatisation (when doing a full clean).</p></li>
</ul>
<section id="clean-data">
<h4>Clean data<a class="headerlink" href="#clean-data" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get stopwords.</span>
<span class="n">stopwords</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check that the cleaning function defined at the top of the notebook</span>
<span class="c1"># is working as expected.</span>
<span class="n">review_number</span> <span class="o">=</span> <span class="mi">11</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--Original&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="n">review_number</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--Basic clean&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clean_text</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="n">review_number</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">full_clean</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--Full clean&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clean_text</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="n">review_number</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">full_clean</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--Original
please please please do not get insurance with this company unless you have the time to write down eveyhing you had pre-exsisting even gastro 5 years ago because i can promise you if you didn&#39;t have it before you will by the time they finish with you so now i will take the time (my precise time) to write a review once a week and hopefully save some poor soul the stress and confusion that i have had to deal with good luck
none zero zilch
i should have read reviews first but because travel agent recommended i thought they would have been really good. foolish me to trust people no wonder the world is becoming what it is with nobody caring well kharma is a real thing so be careful who you rip off and staff be realistic do you think the company will care when you walk out the  door fool fool fool


--Basic clean
please please please do not get insurance with this company unless you have the time to write down everything you had preexisting even castro a years ago because i can promise you if you didst have it before you will by the time they finish with you so now i will take the time my precise time to write a review once a week and hopefully save some poor soul the stress and confusion that i have had to deal with good luck none zero zilch i should have read reviews first but because travel agent recommended i thought they would have been really good foolish me to trust people no wonder the world is becoming what it is with nobody caring well karma is a real thing so be careful who you rip off and staff be realistic do you think the company will care when you walk out the door fool fool fool


--Full clean
plea plea plea get insur compani unless time write everyth preexist even castro year ago promis didst time finish take time precis time write review week hope save poor soul stress confus deal good luck none zero zilch read review first travel agent recommend thought would realli good foolish trust peopl wonder world becom nobodi care well karma real thing care rip staff realist think compani care walk door fool fool fool
</pre></div>
</div>
</div>
</div>
<p>In the above example, take note of what the cleaning process did to the following words:</p>
<ul class="simple">
<li><p>â€˜eveyhingâ€™ was corrected to â€˜everythingâ€™ by the spell-checker;</p></li>
<li><p>â€˜pre-exsistingâ€™ was corrected to â€˜preexistingâ€™ by the spell-checker;</p></li>
<li><p>â€˜gastroâ€™ was corrected to â€˜castroâ€™ by the spell-checker; and</p></li>
<li><p>â€˜pleaseâ€™ was converted to â€˜pleaâ€™ by the stemmer and/or the lemmatiser.</p></li>
</ul>
<p>Do all of these changes make sense?</p>
<p>You should look at the cleaning output for a few different reviews to find other examples of changes that have been made by the cleaning function. Are you happy with all of these changes?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the cleaning function on the full dataset. This step can take a while to run.</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body_clean_full&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">clean_text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">full_clean</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># The lambda function is used above to apply the clean_text function to all the</span>
    <span class="c1"># reviews in the corpus.</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body_clean_bert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">clean_text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">full_clean</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="c1"># The &#39;body_clean_bert&#39; uses a basic clean to prepare the data for use with the</span>
    <span class="c1"># Bert model.</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pubDate</th>
      <th>rating</th>
      <th>title</th>
      <th>body</th>
      <th>url</th>
      <th>pubMonth</th>
      <th>body_clean_full</th>
      <th>body_clean_bert</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2016-07-20T00:30:41Z</td>
      <td>5</td>
      <td>Excellent value.</td>
      <td>I used this travel insurance mainly for the ca...</td>
      <td>https://www.productreview.com.au/reviews/30937...</td>
      <td>2016-07</td>
      <td>use travel insur mainli car hire excess paid c...</td>
      <td>i used this travel insurance mainly for the ca...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-10-30T09:40:07Z</td>
      <td>5</td>
      <td>Great service</td>
      <td>We took out a cover more policy for a quick 10...</td>
      <td>https://www.productreview.com.au/reviews/ba5e7...</td>
      <td>2017-10</td>
      <td>took cover polici quick day trip famili four m...</td>
      <td>we took out a cover more policy for a quick of...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-01-08T03:47:52Z</td>
      <td>1</td>
      <td>Stay Away from CBA Allianz Travel Insurance</td>
      <td>My wife developed a medical condition so we ha...</td>
      <td>https://www.productreview.com.au/reviews/314fd...</td>
      <td>2017-01</td>
      <td>wife develop medic condit put trip month put c...</td>
      <td>my wife developed a medical condition so we ha...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016-09-15T05:16:52Z</td>
      <td>5</td>
      <td>Peace of mind should any problems arise</td>
      <td>Prices getting more expensive as we get older ...</td>
      <td>https://www.productreview.com.au/reviews/0fa5b...</td>
      <td>2016-09</td>
      <td>price get expens get older even good health st...</td>
      <td>prices getting more expensive as we get older ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-10-05T07:10:15Z</td>
      <td>4</td>
      <td>made a claim</td>
      <td>needed to make a claim when I had to cut short...</td>
      <td>https://www.productreview.com.au/reviews/a0508...</td>
      <td>2018-10</td>
      <td>need make claim cut short trip father die sudd...</td>
      <td>needed to make a claim when i had to cut short...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="subset-data">
<h4>Subset data<a class="headerlink" href="#subset-data" title="Permalink to this headline">#</a></h4>
<p>This section allows you to subset the data to be used in the analysis. For example, you might choose a subset of the entire date range, or you might choose to review only observations with a certain rating.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set date range of reviews to be analysed.</span>

<span class="n">Months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2019-01&#39;</span><span class="p">,</span><span class="s1">&#39;2019-02&#39;</span><span class="p">,</span><span class="s1">&#39;2019-03&#39;</span><span class="p">,</span><span class="s1">&#39;2019-04&#39;</span><span class="p">,</span><span class="s1">&#39;2019-05&#39;</span><span class="p">,</span><span class="s1">&#39;2019-06&#39;</span><span class="p">,</span>
          <span class="s1">&#39;2019-07&#39;</span><span class="p">,</span><span class="s1">&#39;2019-08&#39;</span><span class="p">,</span><span class="s1">&#39;2019-09&#39;</span><span class="p">,</span><span class="s1">&#39;2019-10&#39;</span><span class="p">,</span><span class="s1">&#39;2019-11&#39;</span><span class="p">,</span><span class="s1">&#39;2019-12&#39;</span><span class="p">,</span>
          <span class="s1">&#39;2020-01&#39;</span><span class="p">,</span><span class="s1">&#39;2020-02&#39;</span><span class="p">,</span><span class="s1">&#39;2020-03&#39;</span><span class="p">,</span><span class="s1">&#39;2020-04&#39;</span><span class="p">,</span><span class="s1">&#39;2020-05&#39;</span><span class="p">,</span><span class="s1">&#39;2020-06&#39;</span><span class="p">]</span>
          <span class="c1"># Because &#39;pubMonth&#39; is recorded as a string, a list of</span>
          <span class="c1"># string values is created, representing the months of</span>
          <span class="c1"># interest for this analysis.</span>
          <span class="c1"># An alternative approach would be to convert the &#39;pubDate&#39; into</span>
          <span class="c1"># a date and search within a specified date range.</span>

<span class="c1"># Choose which reviews, based on rating, will be included in the analysis.</span>
<span class="c1"># In this case, the focus will be on reviews with a low rating of 1 or 2,</span>
<span class="c1"># to try to understand what makes customers complain about travel insurance.</span>

<span class="n">ratings</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># If you want to apply the subsetting specified above, then remove the &#39;#&#39;</span>
<span class="c1"># at the start of each line below:</span>

<span class="c1"># dataset = dataset[dataset[&#39;pubMonth&#39;].isin(Months)]</span>
<span class="c1"># dataset = dataset[dataset[&#39;rating&#39;].isin(ratings)]</span>
<span class="c1"># print(dataset.shape)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="vectorise">
<h4>Vectorise<a class="headerlink" href="#vectorise" title="Permalink to this headline">#</a></h4>
<p>Two vectorisation approaches are used below:</p>
<ul class="simple">
<li><p>approach 1 uses TF-IDF; and</p></li>
<li><p>approach 2 uses BERT.</p></li>
</ul>
<section id="tf-idf">
<h5>TF-IDF<a class="headerlink" href="#tf-idf" title="Permalink to this headline">#</a></h5>
<p>In this approach, TF-IDF is used to get the statistical weights of the tokens in each review. These weights are then reduced to two dimensions using t-SNE (t-SNE is an alternative dimension reduction technique to PCA). This makes it easier to visualise the different clusters that are found using K-Means clustering (see the Modelling section of the notebook).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate TF-IDF weights</span>
<span class="n">clean_input</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body_clean_full&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">tfidf</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">()</span>
<span class="n">embedding_tfidf</span> <span class="o">=</span> <span class="n">tfidf</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">clean_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Shape of list containing reviews and their tf-idf weights:&#39;</span><span class="p">,</span> <span class="n">embedding_tfidf</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">tsne1</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">embedding_tfidf_tsne</span> <span class="o">=</span> <span class="n">tsne1</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">embedding_tfidf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Shape of list containing reviews and their t-SNE components:&#39;</span><span class="p">,</span> <span class="n">embedding_tfidf_tsne</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape of list containing reviews and their tf-idf weights: (19395, 8598)
Shape of list containing reviews and their t-SNE components: (19395, 2)
</pre></div>
</div>
</div>
</div>
</section>
<section id="bert">
<h5>BERT<a class="headerlink" href="#bert" title="Permalink to this headline">#</a></h5>
<p>This approach uses BERT to get the encodings for each review. These weights are then again reduced to two dimensions using t-SNE to make it easier to visualise the different clusters that are found using K-Means clustering.</p>
<p>Import the BERT data set (the text that has only had basic cleaning).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bert_input</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;body_clean_bert&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting vector embeddings for BERT ...&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Getting vector embeddings for BERT ...
</pre></div>
</div>
</div>
</div>
<p>Create a model to perform embeddings using BERT.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s1">&#39;distilbert-base-nli-mean-tokens&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Perform the embeddings.
Note that the first time this is run, the BERT model will download.
This can take some time as the model is approximately 265Mb.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">bert_input</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">embedding_BERT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting vector embeddings for BERT. Done!&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Shape of list containing reviews and their BERT weights:&#39;</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Getting vector embeddings for BERT. Done!
Shape of list containing reviews and their BERT weights: (19395, 768)
</pre></div>
</div>
</div>
</div>
<p>Again, t-SNE is applied to reduce the dimension of the BERT embeddings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tsne2</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">embedding_BERT_tsne</span> <span class="o">=</span> <span class="n">tsne2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">embedding_BERT</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Shape of list containing reviews and their t-SNE components:&#39;</span><span class="p">,</span>
      <span class="n">embedding_BERT_tsne</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape of list containing reviews and their t-SNE components: (19395, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print an example of a BERT embedding.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bert embedding sample&#39;</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">])</span>
  <span class="c1"># This prints the first 50 vectors created by the BERT</span>
  <span class="c1"># embedding for the first review in the dataset.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bert embedding sample [ 0.07839592 -0.03426155  0.34549624 -0.5389152   0.09483199 -0.6143829
  0.45555508 -0.80263364  0.26621756 -0.18330695  0.24159609  1.0325977
  0.10215842  0.22790357 -0.14811812 -1.2008395   1.0383072   0.52433145
 -0.8693367  -0.33057952 -0.5125885   0.510791    0.14292425  1.0891778
 -0.37536004 -0.6041657   0.05691441 -0.4669992   0.818177    0.42899376
 -0.21324089 -0.14957345 -1.0235013  -0.21922049  0.15937041 -0.31900945
  0.9084414  -0.0330176  -0.08699284 -0.9079751  -0.14651097 -0.49356133
  0.3114979   1.7692568  -0.07382092 -0.18199839 -0.18566728  0.35210767
  0.03142061  0.11990058]
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="modelling">
<h2>Modelling<a class="headerlink" href="#modelling" title="Permalink to this headline">#</a></h2>
<p>This section uses the vectorised reviews to perform topic modelling. This allows the reviews to be clustered into different topics, to identify the main themes that emerge from the reviews.</p>
<section id="using-tf-idf-vectorisation">
<h3>Using TF-IDF vectorisation<a class="headerlink" href="#using-tf-idf-vectorisation" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the TF-IDF approach to cluster the reviews into K topics.</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">kmeans_model1</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<span class="n">score_tfidf_tsne</span> <span class="o">=</span> <span class="n">kmeans_model1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embedding_tfidf_tsne</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">embedding_tfidf_tsne</span><span class="p">)</span>
    <span class="c1"># This step fits the kmeans model and calculates a cluster score (WCSS)</span>
    <span class="c1"># for the model. WCSS measures the (negative) sum of squared distances</span>
    <span class="c1"># of observations to their closest cluster centroid, so a smaller score</span>
    <span class="c1"># indicates a better clustering of the data.</span>
<span class="n">labels_tfidf_kmeans</span> <span class="o">=</span> <span class="n">kmeans_model1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">embedding_tfidf_tsne</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;label_TFIDF_KMeans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels_tfidf_kmeans</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score_tfidf_tsne</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-5327143.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a set of distinct labels from the clustering.</span>
<span class="n">labels1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels_tfidf_kmeans</span><span class="p">)</span>
<span class="n">distinct_labels1</span> <span class="o">=</span>  <span class="nb">set</span><span class="p">(</span><span class="n">labels_tfidf_kmeans</span><span class="p">)</span>

<span class="c1"># Create a plot of the reviews clustered by &#39;topic&#39;.</span>
<span class="c1"># Note that at this point the &#39;topic&#39; of each cluster has not yet</span>
<span class="c1"># been analysed or defined.</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_tfidf_kmeans</span><span class="p">)</span>
<span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">labels1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distinct_labels1</span><span class="p">)):</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">n</span> <span class="p">)</span><span class="o">*</span> <span class="mi">100</span>
    <span class="n">cluster_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cluster </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span> <span class="nb">round</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">embedding_tfidf_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">labels1</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">embedding_tfidf_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">labels1</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">cluster_label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Topic&#39;</span><span class="p">,</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> topics identified with tf-idf, t-SNE and KMeans&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>

<span class="c1"># Create a list of context specific common words that will</span>
<span class="c1"># be hidden in the word clouds produced.</span>
<span class="n">hidden_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;insurance&#39;</span><span class="p">,</span><span class="s1">&#39;travel&#39;</span><span class="p">,</span><span class="s1">&#39;policy&#39;</span><span class="p">,</span><span class="s1">&#39;claim&#39;</span><span class="p">]</span>

<span class="c1"># Create a word cloud to help identify the meaning of</span>
<span class="c1"># each &#39;topic&#39; identified in the KMeans clustering.</span>
<span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">K</span><span class="p">):</span>
    <span class="n">get_wordcloud</span><span class="p">(</span><span class="n">each</span><span class="p">,</span><span class="s1">&#39;label_TFIDF_KMeans&#39;</span><span class="p">,</span><span class="n">hidden_words</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Getting wordcloud for topic 1 ...
Getting wordcloud for topic 2 ...
Getting wordcloud for topic 3 ...
Getting wordcloud for topic 4 ...
Getting wordcloud for topic 5 ...
Getting wordcloud for topic 6 ...
</pre></div>
</div>
<img alt="../_images/DAA_M07_CS2_37_1.png" src="../_images/DAA_M07_CS2_37_1.png" />
<img alt="../_images/DAA_M07_CS2_37_2.png" src="../_images/DAA_M07_CS2_37_2.png" />
<img alt="../_images/DAA_M07_CS2_37_3.png" src="../_images/DAA_M07_CS2_37_3.png" />
<img alt="../_images/DAA_M07_CS2_37_4.png" src="../_images/DAA_M07_CS2_37_4.png" />
<img alt="../_images/DAA_M07_CS2_37_5.png" src="../_images/DAA_M07_CS2_37_5.png" />
<img alt="../_images/DAA_M07_CS2_37_6.png" src="../_images/DAA_M07_CS2_37_6.png" />
<img alt="../_images/DAA_M07_CS2_37_7.png" src="../_images/DAA_M07_CS2_37_7.png" />
</div>
</div>
</section>
<section id="using-bert-vectorisation">
<h3>Using BERT vectorisation<a class="headerlink" href="#using-bert-vectorisation" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply K-Means clustering to the BERT vectors.</span>
<span class="n">K2</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">kmeans_model2</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">K2</span><span class="p">)</span>
<span class="n">score_BERT_tsne</span> <span class="o">=</span> <span class="n">kmeans_model2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embedding_BERT_tsne</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">embedding_BERT_tsne</span><span class="p">)</span>
<span class="n">labels_BERT_kmeans</span> <span class="o">=</span> <span class="n">kmeans_model2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">embedding_BERT_tsne</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;label_BERT_KMeans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels_BERT_kmeans</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score_BERT_tsne</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-4795652.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a set of distinct labels from the clustering.</span>
<span class="n">labels2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels_BERT_kmeans</span><span class="p">)</span>
<span class="n">distinct_labels2</span> <span class="o">=</span>  <span class="nb">set</span><span class="p">(</span><span class="n">labels_BERT_kmeans</span><span class="p">)</span>

<span class="c1"># Create a plot of the reviews clustered by &#39;topic&#39;</span>
<span class="c1"># where the &#39;topic&#39; of each cluster has not yet</span>
<span class="c1"># been analysed.</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">embedding_BERT_tsne</span><span class="p">)</span>
<span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">labels2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distinct_labels2</span><span class="p">)):</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">n</span> <span class="p">)</span><span class="o">*</span> <span class="mi">100</span>
    <span class="n">cluster_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cluster </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span> <span class="nb">round</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">embedding_BERT_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">labels2</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">embedding_BERT_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">labels2</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">cluster_label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Topic&#39;</span><span class="p">,</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> topics identified with BERT, tf-idf and t-SNE&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">K2</span><span class="p">))</span>

<span class="c1"># Create a list of context specific common words that will</span>
<span class="c1"># be hidden in the word clouds producted.</span>
<span class="n">hidden_words2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;insurance&#39;</span><span class="p">,</span><span class="s1">&#39;travel&#39;</span><span class="p">,</span><span class="s1">&#39;policy&#39;</span><span class="p">,</span><span class="s1">&#39;claim&#39;</span><span class="p">]</span>

<span class="c1"># Create a word cloud to help identify the meaning of</span>
<span class="c1"># each &#39;topic&#39; identified in the KMeans clustering.</span>
<span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">K2</span><span class="p">):</span>
    <span class="n">get_wordcloud</span><span class="p">(</span><span class="n">each</span><span class="p">,</span><span class="s1">&#39;label_BERT_KMeans&#39;</span><span class="p">,</span><span class="n">hidden_words2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Getting wordcloud for topic 1 ...
Getting wordcloud for topic 2 ...
Getting wordcloud for topic 3 ...
Getting wordcloud for topic 4 ...
Getting wordcloud for topic 5 ...
Getting wordcloud for topic 6 ...
</pre></div>
</div>
<img alt="../_images/DAA_M07_CS2_40_1.png" src="../_images/DAA_M07_CS2_40_1.png" />
<img alt="../_images/DAA_M07_CS2_40_2.png" src="../_images/DAA_M07_CS2_40_2.png" />
<img alt="../_images/DAA_M07_CS2_40_3.png" src="../_images/DAA_M07_CS2_40_3.png" />
<img alt="../_images/DAA_M07_CS2_40_4.png" src="../_images/DAA_M07_CS2_40_4.png" />
<img alt="../_images/DAA_M07_CS2_40_5.png" src="../_images/DAA_M07_CS2_40_5.png" />
<img alt="../_images/DAA_M07_CS2_40_6.png" src="../_images/DAA_M07_CS2_40_6.png" />
<img alt="../_images/DAA_M07_CS2_40_7.png" src="../_images/DAA_M07_CS2_40_7.png" />
</div>
</div>
</section>
</section>
<section id="evaluate">
<h2>Evaluate<a class="headerlink" href="#evaluate" title="Permalink to this headline">#</a></h2>
<p>This section performs some evaluation of the topic modelling using TF-IDF and BERT.</p>
<p>The metric used below is the â€˜silhouette valueâ€™ which is a measure of how similar observations are to their own cluster compared to other clusters. This is an alternative evaluation measure to those presented in Module 7.</p>
<p>The best silhouette value is 1 and the worst value is -1. Values near 0 indicate overlapping clusters. Negative values generally indicate that an observation has been assigned to the wrong cluster, as a different cluster is more similar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the silhouette value for the TF-IDF based clustering after t-SNE</span>
<span class="c1"># has been applied to reduce the dimension of the embeddings.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Silhouette Score (TF-IDF and t-SNE):&#39;</span><span class="p">,</span>
      <span class="n">silhouette_score</span><span class="p">(</span><span class="n">embedding_tfidf_tsne</span> <span class="p">,</span> <span class="n">labels_tfidf_kmeans</span><span class="p">))</span>

<span class="c1"># Calculate silhouette values for the BERT based clustering.</span>
<span class="c1">#print(&#39;Silhouette Score (BERT):&#39;,</span>
<span class="c1">#      silhouette_score(embedding_BERT , labels_BERT_kmeans))</span>

<span class="c1"># Calculate the silhouette value for the BERT based clustering after t-SNE</span>
<span class="c1"># has been applied to reduce the dimension of the embeddings.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Silhouette Score (BERT and t-SNE):&#39;</span><span class="p">,</span>
      <span class="n">silhouette_score</span><span class="p">(</span><span class="n">embedding_BERT_tsne</span> <span class="p">,</span> <span class="n">labels_BERT_kmeans</span><span class="p">))</span>

<span class="c1"># The WCSS scores for the TF-IDF and BERT models are also shown:</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WCSS Score (TF-IDF and t-SNE):&#39;</span><span class="p">,</span> <span class="n">score_tfidf_tsne</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WCSS Score (BERT):&#39;</span><span class="p">,</span> <span class="n">score_BERT_tsne</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Silhouette Score (TF-IDF and t-SNE): 0.35396862
Silhouette Score (BERT and t-SNE): 0.37421986
WCSS Score (TF-IDF and t-SNE): -5327143.0
WCSS Score (BERT): -4795652.0
</pre></div>
</div>
</div>
</div>
<p>The output above suggests that the embeddings using BERT produced marginally better clustering outcomes, with a slightly higher silhouette value and WCSS score.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="commentary">
<h1>Commentary<a class="headerlink" href="#commentary" title="Permalink to this headline">#</a></h1>
<p>The â€˜Monitor resultsâ€™ section of Case Study 2 in Module 6 of the DAA course contained a discussion of how the analysis such as that conducted above can be used to interpret key areas or themes of feedback from travel insurance customers.</p>
<p>The reader can play around with analysing different subsets of the reviews in this case study, to see what themes emerge for reviews with high and low ratings, and for reviews over different time periods.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ActuariesInstitute/cookbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="DAA_M07_CS1.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Py: Classifying review sentiment</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="DAA_2021_S2_Tutorial10_exercise_scipy.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Py: Linear Programming</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By YDAWG, DAPC, YAC and other contributors.<br/>
  
    <div class="extra_footer">
       The Actuaries' Analytical Cookbook is a series of data and analytics recipes to help actuaries quickly get started with a new project.   This site is intended to be a resource to actuaries in both data science and traditional fields.  Opinions expressed in this publication are the opinions of contributors and do not necessarily represent those of either the Institute of Actuaries of Australia (the â€˜Instituteâ€™), its members, directors, officers, employees, agents, or that of the employers of the contributors. <br>Â© Institute of Actuaries of Australia and Contributors 2021. All rights reserved.
    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>